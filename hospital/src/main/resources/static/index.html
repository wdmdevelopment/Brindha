<!DOCTYPE html>
<html lang="en">

<head>
	<title>Home Page</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">


	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/css/bootstrap.min.css" rel="stylesheet">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.1/dist/js/bootstrap.bundle.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

	<script src="https://kit.fontawesome.com/54e0ebeaef.js" crossorigin="anonymous"></script>
	<link rel="stylesheet" href="./CSS/home.css">

</head>

<body>
<div id="navbar">

</div>


<script>
	$(document).ready(function(){ 
   
	   if(localStorage.getItem('name') !== '' && localStorage.getItem('email') !== ""){
		   $("#navbar").load("Navbar.html");
		   hospital();
	   }else{
		location.replace("/")
	   }




	});
	</script>


	<!-- <nav class="navbar navbar-expand-sm navbar-dark bg-primary fixed-top">

		<div class="container-fluid" id="myHos">

			<a class="navbar-brand" href="#">
				<img src="../images/logo.jpg" alt="Logo" style="width:40px;" class="img-thumbnail">
			</a>
			<button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#mynavbar">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="mynavbar">

				<ul class="navbar-nav me-auto">
					<li class="nav-item">
						<a class="nav-link" href="#" style="font-weight: bold">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#" style="font-weight: bold" onclick="hospital()">Hospital</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="#" style="font-weight: bold">Services</a>
					</li>
				</ul>
				<form class="d-flex">
					<input class="form-control me-2" type="search" placeholder="Search" id="searchHospital" onkeyup="searchHos()">
					
				</form>
				<div class="navbar-brand dropdown"  style="padding-left: 40px; padding-right: 20px;">
					<button type="button" class="btn btn-warning dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i
						class="fa-solid fa-user-large">
						<span id="userName"></span></i>
					</button>
					<ul class="dropdown-menu" class="mx-auto">
					  <li><a class="dropdown-item text-dark" href="login.html" style="width: 4px; padding-left: 20%;" onclick="clearUser()">Logout</a></li>
					
					</ul>
				  </div>
	
			</div>
		</div>

	</nav> -->




	<div class="back">


		<div class="content">
			<button class="admin btn btn-outline-warning float-end" type="button" data-bs-toggle="modal"
				data-bs-target="#hospitalModal" style="display: none;">+ Add Hospital</button>
		</div>
	
		<div class="row" id="myHospital" style="padding: 15% 5% 10% 5%; background-image: linear-gradient(rgba(0, 0, 29, 0.8), rgba(0,0,50,0.8));">


		</div>
		
	</div>
	

	<div class="modal fade" id="hospitalModal">
		<div class="modal-dialog modal-dialog-scrollable">
			<div class="modal-content">
				<div class="modal-header">
					<h1 class="modal-title">Hospital Info</h1>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">

					<form class="needs-validation" novalidate>
						<div class="mb-3">

							<label class="col-form-label" for="hospital"><i>Hospital Name</i></label>
							<input type="text" id="name" class="form-control" required />

						</div>
						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>Contact No</i></label>

							<input type="text" id="mob" class="form-control" required />

						</div>
						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>City</i></label>
							<input type="text" id="city" class="form-control" />


						</div>
						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>District</i></label>

							<input type="text" id="district" class="form-control" />

						</div>

						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>State</i></label>

							<input type="text" id="state" class="form-control" required />

						</div>

						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>Country</i></label>

							<input type="text" id="country" class="form-control" required />

						</div>

						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>Zip</i></label>

							<input type="text" id="pincode" class="form-control" required />

						</div>

						<div class="mb-3">
							<label class="col-form-label" for="hospital"><i>Facility</i></label>

							<input type="text" id="facility" class="form-control" required>

						</div>

						<div class="mb-3">
							<label class="col-form-label" for="image"><i>Choose Image</i></label>
							<input type="file" id="myImg" name="filename" class="form-control" required>

						</div>
				</div>

				<div class="alert alert-danger" role="alert">* Please fill the field before you submit.</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-success" id="saveHos" data-dismiss="modal">Save</button>
					<button type="button" class="btn btn-danger" data-bs-dismiss="modal">Cancel</button>

				</div>
			</div>
		</div>
	</div>

	<!-- view Slots -->

	<div class="modal fade" id="viewSlot" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
		  <div class="modal-content">
			 <div class="container">
				  <div class="table-wrapper">
					  <div class="table-title">
						  <div class="row">
							  <h1 class="modal-title fs-5 text-center" id="slot">Book your slot</h1>
							  
						  </div>
					  </div>
					  <br>
					  <table class="table table-bordered border-light">
						  <thead>
							  <tr>
								  <th>Facility Name</th>
								  <th>Price</th>
								  <th>Date</th>
								  <th>Start Time</th>
								  <th>End Time</th>
								  <th>Status</th>
								  <th>Actions</th>
		  
							  </tr>
						  </thead>
						  <tbody id="myHospital1">
								
						  </tbody>
					  </table>
					  
				  </div>
			  </div> 
		 
		  </div>
		</div>
	  </div> 



  <!-- add slots -->
  <div class="modal fade" id="addSlots" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-xl">
	  <div class="modal-content">
	
		  <div class="container">
        <div class="table-wrapper">
            <div class="table-title">
                <div class="row">
					<h1 class="modal-title fs-5 text-center" id="exampleModalLabel">Add Slots</h1>
                    <div class="col-sm-4">
						<button type="button" class="btn btn-primary add-new"><i class="fa fa-plus"></i> Add New</button>
                    </div>
                </div>
            </div>
			<br>
			<table class="table table-bordered border-primary">
                <thead>
                    <tr>
                        <th>Facility Name</th>
                        <th>Price</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Status</th>
                        <th>Actions</th>

                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Eye</td>
                        <td>1234</td>
                        <td>23-04-2023</td>
                        <td>11:11:00</td>
                        <td>11:11:00</td>
                        <td>Open</td>
						
                        <td>
                            <button class="btn btn-outline-warning" title="Add" data-toggle="tooltip" type="button">Edit</button>
                            <button class="btn btn-outline-danger" title="Add" data-toggle="tooltip" type="button">Delete</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Eye</td>
                        <td>1234</td>
                        <td>23-04-2023</td>
                        <td>11:11:00</td>
                        <td>11:11:00</td>
                        <td>Open</td>
						<td>
                            <button class="btn btn-outline-warning" title="Add" data-toggle="tooltip" type="button">Edit</button>
                            <button class="btn btn-outline-danger" title="Add" data-toggle="tooltip" type="button">Delete</button>
                        </td>
                    </tr>
                    <tr>
                        <td>Eye</td>
                        <td>1234</td>
                        <td>23-04-2023</td>
                        <td>11:11:00</td>
                        <td>11:11:00</td>
                        <td>Open</td>
						<td>
                            <button class="btn btn-outline-warning" title="Add" data-toggle="tooltip" type="button">Edit</button>
                            <button class="btn btn-outline-danger" title="Add" data-toggle="tooltip" type="button">Delete</button>
                        </td>
                    </tr>  
                </tbody>
            </table>
			<button class="btn btn-success float-end btn-lg" id="saveSlot" type="button">Save</button>
        </div>
    </div> 
	  </div>
	</div>
  </div>
<script>

$(document).ready(function(){
	$('[data-toggle="tooltip"]').tooltip();
	var actions = $("table td:last-child").html();
	// Append table with add row form on add new button click
    $(".add-new").click(function(){
		$(this).attr("disabled", "disabled");
		var index = $("table tbody tr:last-child").index();
        var row = '<tr>' +
            '<td><input type="text" class="form-control" name="fac" id="fac"></td>' +
            '<td><input type="text" class="form-control" name="price" id="price"></td>' +
            '<td><input type="date" class="form-control" name="date" id="date"></td>' +
            '<td><input type="text" class="form-control" name="start" id="start"></td>' +
            '<td><input type="text" class="form-control" name="end" id="end"></td>' +
            '<td><input type="text" class="form-control" name="slotStatus" id="slotStatus"></td>' +
			'<td>' + actions + '</td>' +
        '</tr>';
    	$("table").append(row);		
		$("table tbody tr").eq(index + 1).find(".add, .edit").toggle();
        $('[data-toggle="tooltip"]').tooltip();
    });


// POST OPERATION --- SLOT

$(document).ready(function () {
			$("#saveSlot").click(function () {

				var url = "http://localhost:8080/slot";

				var facilityName = $("#fac").val();
				var price = $("#price").val();
				var slotDate = $("#date").val();
				var slotStartTime = $("#start").val();
				var slotEndTime = $("#end").val();
				var status = $("#slotStatus").val();

				var slot={
					'facilityName': facilityName,
					'price': price,
					'slotDate': slotDate,
					'slotStartTime': slotStartTime,
					'slotEndTime': slotEndTime,
					'status': status,
					'userId': localStorage.getItem('userId')
				};
				console.log(slot);
				$.ajax({

					url: url,
					type: "POST",
					data: JSON.stringify(slot),
					contentType: "application/json",
					success: function(data){
						alert("Slot saved!!!");
						console.log(data);
					}, error: function (e){
						alert(JSON.stringify(e));  
						console.log(e);
					}
				})
				})
			})

	// Add row on add button click
	$(document).on("click", ".add", function(){
		var empty = false;
		var input = $(this).parents("tr").find('input[type="text"]');
        input.each(function(){
			if(!$(this).val()){
				$(this).addClass("error");
				empty = true;
			} else{
                $(this).removeClass("error");
            }
		});
		$(this).parents("tr").find(".error").first().focus();
		if(!empty){
			input.each(function(){
				$(this).parent("td").html($(this).val());
			});			
			$(this).parents("tr").find(".add, .edit").toggle();
			$(".add-new").removeAttr("disabled");
		}		
    });
});
</script>


<!-- 
logout user clear
	
	<script>
	function clearUser() {

			localStorage.removeItem("name");
			localStorage.removeItem("age");
			localStorage.removeItem("role");
			localStorage.removeItem("email");
			localStorage.removeItem("password");
			localStorage.removeItem("userId");
	
		}
	</script> -->

	<script>



		// -----------------POST Opertion HOSPITAL----------------
		$(document).ready(function () {
			$("#saveHos").click(function () {

				var url = "http://localhost:8080/hospital";


				const formData = new FormData();
				var file = $('#myImg').prop("files")[0];

				var hospitalName = $("#name").val();
				var contactNum = $("#mob").val();
				var city = $("#city").val();
				var district = $("#district").val();
				var state = $("#state").val();
				var country = $("#country").val();
				var pincode = $("#pincode").val();
				var facilityName = $("#facility").val();

				formData.append('data', JSON.stringify({
					'hospitalName': hospitalName,
					'contactNum': contactNum,
					'city': city,
					'district': district,
					'state': state,
					'country': country,
					'pincode': pincode,
					'facilityName': facilityName,
					'userId': localStorage.getItem('userId')

				})),
					formData.append('imagefile', file);
				$.ajax({

					type: "POST",
					url: url,
					data: formData,
					contentType: false,
					processData: false,
					success: function (reqHosPost) {
						$('#hospitalModal').modal('hide');
						hospital();

					}, error: function (e) {
						alert("Please fill all the fields")
					}

				})
			})

		})





		// ---------------------get OPERATION HOSPITAL------------------


		var hospitalData = "";
		 var adminHospital = "";
		function hospital() {

			$.ajax({
				dataTypa: "JSON",
				url: "http://localhost:8080/hospital",
				type: "GET",

				success: function (responseText) {


					if (localStorage.getItem('role') == 'admin') {

						adminHospital = '<button type="button" class="btn btn-outline-warning mt-3 float-end" data-bs-toggle="modal" data-bs-target="#hospitalModal">+ Add Hospital</button>';
					}

					$.each(responseText, function (index, item) {


						hospitalData += ' <div class="col-lg-4 col-md-4"><div class="card mb-3">';

						$.each(item.hospitalImg, function (indeximg, itemimg) {

							hospitalData += '<img class="img-fluid"  style="object-fit: cover; height: max(17rem, 30vh);" src="data:image/png;base64,' + itemimg.imageData + '"/>';

						});

						hospitalData += '<div class="card-body"><h2 class="card-title text-dark text-center">' + item.hospitalName + ' </h2><h5 class="card-text text-dark text-center">' + "Contact: " + item.contactNum + '</h5><p class="card-text text-dark text-center">' + "Locates At: " + item.address.city + '</p><p class="card-text text-dark text-center">' + item.address.district + '-' + item.address.pincode + '</p><p class="card-text text-dark text-center">' + item.address.state + ', ' + item.address.country + '.</p>';



						if (localStorage.getItem('role') == "admin") {


							hospitalData += '<div class="d-grid gap-1 d-md-flex justify-content-md-end"><a onclick="editHospital(' + item.productId + ')" class="btn btn-primary btn-sm float-text-center card-link"><b>Edit</b></a> <a onclick="deleteHospital(' + item.productId + ')" class="btn btn-primary btn-sm float-text-center card-link "><b>Delete</b></a> <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addSlots">+ Add Slot</button> </div>';
						}
						else {
							hospitalData += '<div class="d-grid gap-2 col-4 mx-auto"> <button type="button" class="btn btn-primary float-text-center" data-bs-toggle="modal" data-bs-target="#viewSlot" onclick="slotHospital()" style="border-radius:50px">Book Now</button></div>';
						}

						

						hospitalData += '</div></div></div>';

					});
					$("#myHospital").empty();
					$(".adminHospital").append(adminHospital);
					$("#myHospital").append(hospitalData);
					
				}

			});
		}

		// ------------------  get operation for SLOT  ----------------------


		function slotHospital(){
			$.ajax({
				dataTypa: "JSON",
				url: "http://localhost:8080/slot",
				type: "GET",
				
				success: function (responseText) {
					console.log(responseText);
					var slot ="";
					$.each(responseText, function (index, item ) {
						slot += "<tr><td>" + item.facility.facilityName + "</td><td>" + item.price + "</td><td>" + item.slotDate + "</td><td>" + item.slotStartTime + "</td><td>" + item.slotEndTime + "</td><td>" + item.status + "</td><td>" + item.status + "</td><td>BOOK</td></tr>";
					});
					$("#myHospital1").empty();					
					$("#myHospital1").append(slot);
				},
				error: function (e){
					console.log(JSON.stringify(e));
					}
				});
		}

	</script>

</body>

</html>